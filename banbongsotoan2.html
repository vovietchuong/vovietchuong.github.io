<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>B·∫Øn B√≥ng S·ªë - To√°n L·ªõp 2</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Comic Sans MS', cursive, sans-serif;
    }
    
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(to bottom, #1e90ff, #87ceeb);
      overflow: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
      color: #333;
    }
    
    .header {
      text-align: center;
      padding: 10px;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      z-index: 10;
    }
    
    h1 {
      color: #ff6b6b;
      margin-bottom: 5px;
      font-size: 2rem;
      text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.1);
    }
    
    .game-info {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    
    .info-box {
      background: linear-gradient(145deg, #4e73df, #2e59d9);
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      font-weight: bold;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
    }
    
    #gameArea {
      position: relative;
      width: 100%;
      flex-grow: 1;
      overflow: hidden;
      background: rgba(255, 255, 255, 0.2);
    }
    
    .balloon {
      position: absolute;
      bottom: -100px;
      width: 80px;  /* TƒÉng k√≠ch th∆∞·ªõc b√≥ng */
      height: 100px; /* TƒÉng k√≠ch th∆∞·ªõc b√≥ng */
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 120"><path fill="%23ff6b6b" d="M50 10 C70 10 85 30 85 60 C85 90 70 110 50 110 C30 110 15 90 15 60 C15 30 30 10 50 10 Z"/><path fill="%23ffffff" d="M40 40 C45 35 55 35 60 40 C55 45 45 45 40 40 Z"/></svg>');
      background-size: contain;
      background-repeat: no-repeat;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 18px; /* Gi·∫£m k√≠ch th∆∞·ªõc font */
      font-weight: bold;
      color: #fff;
      text-shadow: 1px 1px 2px #000;
      transition: transform 0.2s;
      cursor: pointer;
      padding: 5px;
      box-sizing: border-box;
    }
    
    .expression {
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.2;
      padding: 0 5px;
    }
    
    .balloon:hover {
      transform: scale(1.1);
    }
    
    .balloon.hit {
      animation: pop 0.5s forwards;
    }
    
    @keyframes pop {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.5); opacity: 0.7; }
      100% { transform: scale(0); opacity: 0; }
    }
    
    #controls {
      padding: 15px;
      background: rgba(255, 255, 255, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
    }
    
    #answerInput {
      font-size: 20px;
      padding: 10px 15px;
      width: 120px;
      border: 2px solid #4e73df;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    #shootBtn {
      background: linear-gradient(145deg, #ff6b6b, #e55656);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 10px 20px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
    }
    
    #shootBtn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
    }
    
    #shootBtn:active {
      transform: translateY(0);
    }
    
    #startBtn {
      background: linear-gradient(145deg, #1cc88a, #0f9d58);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 10px 20px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
    }
    
    #startBtn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
    }
    
    .home-btn {
      position: absolute;
      top: 15px;
      left: 15px;
      background: linear-gradient(145deg, #4e73df, #2e59d9);
      color: white;
      border: none;
      border-radius: 50px;
      padding: 10px 20px;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      z-index: 100;
    }
    
    .home-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }
    
    .home-btn i {
      margin-right: 8px;
    }
    
    .feedback {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 3rem;
      font-weight: bold;
      color: #ff6b6b;
      opacity: 0;
      pointer-events: none;
      z-index: 1000;
      text-shadow: 2px 2px 0 #fff, -2px -2px 0 #fff, 2px -2px 0 #fff, -2px 2px 0 #fff;
      transition: opacity 0.3s;
    }
    
    .level-select {
      display: flex;
      gap: 10px;
      margin: 10px 0;
    }
    
    .level-btn {
      padding: 8px 15px;
      border: none;
      border-radius: 20px;
      background: #e3f2fd;
      color: #1976d2;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: bold;
    }
    
    .level-btn.active {
      background: linear-gradient(145deg, #3949ab, #1a237e);
      color: white;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    @media (max-width: 768px) {
      h1 {
        font-size: 1.5rem;
      }
      
      .info-box {
        font-size: 0.9rem;
        padding: 6px 12px;
      }
      
      #answerInput {
        font-size: 18px;
        padding: 8px 12px;
        width: 100px;
      }
      
      #shootBtn, #startBtn {
        font-size: 16px;
        padding: 8px 16px;
      }
      
      .balloon {
        width: 70px;
        height: 90px;
        font-size: 16px;
      }
    }
    
    @media (max-width: 480px) {
      .game-info {
        gap: 10px;
      }
      
      .info-box {
        font-size: 0.8rem;
        padding: 5px 10px;
      }
      
      #controls {
        flex-direction: column;
        gap: 15px;
      }
      
      .home-btn {
        top: 10px;
        left: 10px;
        padding: 8px 15px;
        font-size: 0.9rem;
      }
      
      .balloon {
        width: 65px;
        height: 85px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <button class="home-btn" onclick="goHome()">
    <i class="fas fa-home"></i> Trang ch·ªß
  </button>

  <div class="header">
    <h1>üéà B·∫Øn B√≥ng S·ªë - To√°n L·ªõp 2 üéà</h1>
    <div class="level-select">
      <button class="level-btn active" data-level="easy">D·ªÖ</button>
      <button class="level-btn" data-level="medium">Trung b√¨nh</button>
      <button class="level-btn" data-level="hard">Kh√≥</button>
    </div>
    <div class="game-info">
      <div class="info-box">ƒêi·ªÉm: <span id="score">0</span></div>
      <div class="info-box">B√≥ng ƒë√£ b·∫Øn: <span id="balloonsShot">0</span></div>
      <div class="info-box">B√≥ng ƒë√∫ng: <span id="correctShots">0</span></div>
      <div class="info-box">M·∫°ng: <span id="lives">3</span> ‚ù§Ô∏è</div>
    </div>
  </div>

  <div id="gameArea"></div>

  <div id="controls">
    <input type="number" id="answerInput" placeholder="Nh·∫≠p s·ªë">
    <button id="shootBtn" onclick="checkAnswer()">B·∫Øn!</button>
    <button id="startBtn" onclick="startGame()">B·∫Øt ƒë·∫ßu</button>
  </div>

  <div class="feedback" id="feedback"></div>

  <script>
    const gameArea = document.getElementById("gameArea");
    const answerInput = document.getElementById("answerInput");
    const scoreBox = document.getElementById("score");
    const balloonsShotBox = document.getElementById("balloonsShot");
    const correctShotsBox = document.getElementById("correctShots");
    const livesBox = document.getElementById("lives");
    const feedback = document.getElementById("feedback");
    const levelButtons = document.querySelectorAll('.level-btn');
    
    let balloons = [];
    let score = 0;
    let balloonsShot = 0;
    let correctShots = 0;
    let lives = 3;
    let gameActive = false;
    let gameSpeed = 1;
    let difficulty = "easy";
    let balloonInterval;
    let moveInterval;

    // H√†m ƒëi·ªÅu h∆∞·ªõng v·ªÅ trang ch·ªß
    function goHome() {
      window.location.href = "index.html";
    }

    // H√†m ch·ªçn ƒë·ªô kh√≥
    levelButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        levelButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        difficulty = btn.dataset.level;
        
        // C·∫≠p nh·∫≠t t·ªëc ƒë·ªô game theo ƒë·ªô kh√≥
        switch(difficulty) {
          case "easy":
            gameSpeed = 1;
            break;
          case "medium":
            gameSpeed = 1.5;
            break;
          case "hard":
            gameSpeed = 2;
            break;
        }
      });
    });

    // H√†m b·∫Øt ƒë·∫ßu game
    function startGame() {
      if (gameActive) return;
      
      // Reset game state
      gameActive = true;
      score = 0;
      balloonsShot = 0;
      correctShots = 0;
      lives = 3;
      balloons = [];
      
      // X√≥a t·∫•t c·∫£ b√≥ng hi·ªán c√≥
      gameArea.innerHTML = '';
      
      // C·∫≠p nh·∫≠t giao di·ªán
      scoreBox.textContent = score;
      balloonsShotBox.textContent = balloonsShot;
      correctShotsBox.textContent = correctShots;
      livesBox.textContent = lives;
      
      // B·∫Øt ƒë·∫ßu t·∫°o b√≥ng
      clearInterval(balloonInterval);
      balloonInterval = setInterval(createBalloon, 2000);
      
      // B·∫Øt ƒë·∫ßu di chuy·ªÉn b√≥ng
      clearInterval(moveInterval);
      moveInterval = setInterval(moveBalloons, 50);
      
      // Focus v√†o √¥ nh·∫≠p
      answerInput.focus();
    }

    // H√†m t·∫°o b√≥ng
    function createBalloon() {
      if (!gameActive) return;
      
      let a, b, op, expression, result;
      
      // T·∫°o ph√©p t√≠nh theo ƒë·ªô kh√≥
      switch(difficulty) {
        case "easy":
          a = Math.floor(Math.random() * 10) + 1;
          b = Math.floor(Math.random() * 10) + 1;
          op = Math.random() > 0.5 ? "+" : "-";
          break;
        case "medium":
          a = Math.floor(Math.random() * 20) + 1;
          b = Math.floor(Math.random() * 20) + 1;
          op = Math.random() > 0.7 ? "+" : "-";
          break;
        case "hard":
          a = Math.floor(Math.random() * 50) + 1;
          b = Math.floor(Math.random() * 50) + 1;
          op = Math.random() > 0.5 ? "+" : "-";
          break;
      }
      
      expression = `${a} ${op} ${b}`;
      result = eval(expression);
      
      // ƒê·∫£m b·∫£o k·∫øt qu·∫£ kh√¥ng √¢m v√† l√† s·ªë nguy√™n
      if (result < 0 || !Number.isInteger(result)) {
        createBalloon(); // Th·ª≠ l·∫°i
        return;
      }
      
      // T·∫°o ph·∫ßn t·ª≠ b√≥ng
      let balloon = document.createElement("div");
      balloon.classList.add("balloon");
      balloon.style.left = Math.random() * (window.innerWidth - 100) + "px";
      
      // Th√™m bi·ªÉu th·ª©c to√°n h·ªçc v√†o b√≥ng
      let expressionDiv = document.createElement("div");
      expressionDiv.classList.add("expression");
      expressionDiv.textContent = expression;
      balloon.appendChild(expressionDiv);
      
      balloon.dataset.answer = result;
      
      // M√†u s·∫Øc ng·∫´u nhi√™n cho b√≥ng
      const colors = ["#ff6b6b", "#74b9ff", "#ffeaa7", "#55efc4", "#a29bfe", "#fdcb6e"];
      const color = colors[Math.floor(Math.random() * colors.length)];
      balloon.style.background = `url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 120"><path fill="${encodeURIComponent(color)}" d="M50 10 C70 10 85 30 85 60 C85 90 70 110 50 110 C30 110 15 90 15 60 C15 30 30 10 50 10 Z"/><path fill="%23ffffff" d="M40 40 C45 35 55 35 60 40 C55 45 45 45 40 40 Z"/></svg>')`;
      balloon.style.backgroundSize = "contain";
      balloon.style.backgroundRepeat = "no-repeat";
      
      gameArea.appendChild(balloon);
      
      balloons.push({ 
        element: balloon, 
        answer: result, 
        y: 0,
        speed: Math.random() * 1 + gameSpeed // T·ªëc ƒë·ªô bay ng·∫´u nhi√™n
      });
    }

    // H√†m di chuy·ªÉn b√≥ng
    function moveBalloons() {
      if (!gameActive) return;
      
      balloons.forEach((balloon, index) => {
        balloon.y += balloon.speed;
        balloon.element.style.bottom = balloon.y + "px";
        
        // Ki·ªÉm tra n·∫øu b√≥ng bay qu√° cao
        if (balloon.y > window.innerHeight) {
          balloon.element.remove();
          balloons.splice(index, 1);
          loseLife();
        }
      });
    }

    // H√†m m·∫•t m·∫°ng
    function loseLife() {
      lives--;
      livesBox.textContent = lives;
      
      // Hi·ªáu ·ª©ng rung m√†n h√¨nh
      document.body.style.animation = "shake 0.5s";
      setTimeout(() => {
        document.body.style.animation = "";
      }, 500);
      
      // Ki·ªÉm tra thua
      if (lives <= 0) {
        endGame();
        showFeedback("Game Over! üíÄ", false);
      }
    }

    // H√†m ki·ªÉm tra ƒë√°p √°n
    function checkAnswer() {
      if (!gameActive) return;
      
      let value = parseInt(answerInput.value);
      if (isNaN(value)) return;
      
      balloonsShot++;
      balloonsShotBox.textContent = balloonsShot;
      
      let hitIndex = balloons.findIndex(b => b.answer === value);
      
      if (hitIndex !== -1) {
        // B·∫Øn tr√∫ng
        balloons[hitIndex].element.classList.add("hit");
        showFeedback("+10 ƒëi·ªÉm! üéØ", true);
        
        setTimeout(() => {
          balloons[hitIndex].element.remove();
          balloons.splice(hitIndex, 1);
        }, 500);
        
        score += 10;
        correctShots++;
      } else {
        // B·∫Øn tr∆∞·ª£t
        showFeedback("Tr∆∞·ª£t r·ªìi! üòÖ", false);
        score = Math.max(0, score - 2); // Tr·ª´ ƒëi·ªÉm nh∆∞ng kh√¥ng √¢m
      }
      
      // C·∫≠p nh·∫≠t ƒëi·ªÉm
      scoreBox.textContent = score;
      correctShotsBox.textContent = correctShots;
      answerInput.value = "";
      answerInput.focus();
    }

    // H√†m hi·ªÉn th·ªã ph·∫£n h·ªìi
    function showFeedback(message, isSuccess) {
      feedback.textContent = message;
      feedback.style.color = isSuccess ? "#00b894" : "#ff6b6b";
      feedback.style.opacity = "1";
      
      setTimeout(() => {
        feedback.style.opacity = "0";
      }, 1000);
    }

    // H√†m k·∫øt th√∫c game
    function endGame() {
      gameActive = false;
      clearInterval(balloonInterval);
      clearInterval(moveInterval);
      
      // Hi·ªÉn th·ªã k·∫øt qu·∫£
      setTimeout(() => {
        alert(`Game Over!\nƒêi·ªÉm s·ªë: ${score}\nB√≥ng ƒë√£ b·∫Øn: ${balloonsShot}\nB√≥ng tr√∫ng: ${correctShots}`);
      }, 500);
    }

    // Cho ph√©p b·∫•m Enter ƒë·ªÉ b·∫Øn
    answerInput.addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        checkAnswer();
      }
    });

    // Cho ph√©p click tr·ª±c ti·∫øp v√†o b√≥ng ƒë·ªÉ b·∫Øn
    gameArea.addEventListener("click", function(event) {
      if (!gameActive) return;
      
      const balloon = event.target.closest(".balloon");
      if (balloon) {
        answerInput.value = balloon.dataset.answer;
        checkAnswer();
      }
    });

    // Kh·ªüi t·∫°o game
    window.onload = function() {
      answerInput.focus();
    };
  </script>
</body>
</html>